{"ast":null,"code":"import { supabase } from \"../supabaseClient\"; // Adjust path if needed\n\nexport const subscribeToAirdrops = setAirdrops => {\n  // Fetch initial data (exclude \"id\" explicitly)\n  const fetchAirdrops = async () => {\n    const {\n      data,\n      error\n    } = await supabase.from(\"available_airdrops\").select(\"project_name, task_link, chain, airdrop_type, device_needed, status\"); // ✅ Excludes \"id\"\n\n    if (error) {\n      console.error(\"Error fetching airdrops:\", error);\n    } else {\n      setAirdrops(data);\n    }\n  };\n  fetchAirdrops();\n\n  // Subscribe to real-time updates\n  const channel = supabase.channel(\"available_airdrops\").on(\"postgres_changes\", {\n    event: \"INSERT\",\n    schema: \"public\",\n    table: \"available_airdrops\"\n  }, payload => {\n    console.log(\"New airdrop received:\", payload);\n    setAirdrops(prev => [...prev, payload.new]);\n  }).subscribe();\n  return () => {\n    supabase.removeChannel(channel); // Cleanup on unmount\n  };\n};","map":{"version":3,"names":["supabase","subscribeToAirdrops","setAirdrops","fetchAirdrops","data","error","from","select","console","channel","on","event","schema","table","payload","log","prev","new","subscribe","removeChannel"],"sources":["C:/Users/opril/cryptoknow/src/utils/supabaseSubscription.js"],"sourcesContent":["import { supabase } from \"../supabaseClient\"; // Adjust path if needed\r\n\r\nexport const subscribeToAirdrops = (setAirdrops) => {\r\n  // Fetch initial data (exclude \"id\" explicitly)\r\n  const fetchAirdrops = async () => {\r\n    const { data, error } = await supabase\r\n      .from(\"available_airdrops\")\r\n      .select(\"project_name, task_link, chain, airdrop_type, device_needed, status\"); // ✅ Excludes \"id\"\r\n\r\n    if (error) {\r\n      console.error(\"Error fetching airdrops:\", error);\r\n    } else {\r\n      setAirdrops(data);\r\n    }\r\n  };\r\n\r\n  fetchAirdrops();\r\n\r\n  // Subscribe to real-time updates\r\n  const channel = supabase\r\n    .channel(\"available_airdrops\")\r\n    .on(\r\n      \"postgres_changes\",\r\n      { event: \"INSERT\", schema: \"public\", table: \"available_airdrops\" },\r\n      (payload) => {\r\n        console.log(\"New airdrop received:\", payload);\r\n        setAirdrops((prev) => [...prev, payload.new]);\r\n      }\r\n    )\r\n    .subscribe();\r\n\r\n  return () => {\r\n    supabase.removeChannel(channel); // Cleanup on unmount\r\n  };\r\n};\r\n"],"mappings":"AAAA,SAASA,QAAQ,QAAQ,mBAAmB,CAAC,CAAC;;AAE9C,OAAO,MAAMC,mBAAmB,GAAIC,WAAW,IAAK;EAClD;EACA,MAAMC,aAAa,GAAG,MAAAA,CAAA,KAAY;IAChC,MAAM;MAAEC,IAAI;MAAEC;IAAM,CAAC,GAAG,MAAML,QAAQ,CACnCM,IAAI,CAAC,oBAAoB,CAAC,CAC1BC,MAAM,CAAC,qEAAqE,CAAC,CAAC,CAAC;;IAElF,IAAIF,KAAK,EAAE;MACTG,OAAO,CAACH,KAAK,CAAC,0BAA0B,EAAEA,KAAK,CAAC;IAClD,CAAC,MAAM;MACLH,WAAW,CAACE,IAAI,CAAC;IACnB;EACF,CAAC;EAEDD,aAAa,CAAC,CAAC;;EAEf;EACA,MAAMM,OAAO,GAAGT,QAAQ,CACrBS,OAAO,CAAC,oBAAoB,CAAC,CAC7BC,EAAE,CACD,kBAAkB,EAClB;IAAEC,KAAK,EAAE,QAAQ;IAAEC,MAAM,EAAE,QAAQ;IAAEC,KAAK,EAAE;EAAqB,CAAC,EACjEC,OAAO,IAAK;IACXN,OAAO,CAACO,GAAG,CAAC,uBAAuB,EAAED,OAAO,CAAC;IAC7CZ,WAAW,CAAEc,IAAI,IAAK,CAAC,GAAGA,IAAI,EAAEF,OAAO,CAACG,GAAG,CAAC,CAAC;EAC/C,CACF,CAAC,CACAC,SAAS,CAAC,CAAC;EAEd,OAAO,MAAM;IACXlB,QAAQ,CAACmB,aAAa,CAACV,OAAO,CAAC,CAAC,CAAC;EACnC,CAAC;AACH,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}