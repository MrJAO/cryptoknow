{"ast":null,"code":"// src/App.js\nimport React,{useState,useEffect}from'react';import{BrowserRouter,Routes,Route}from'react-router-dom';import{createClient}from'@supabase/supabase-js';import Sidebar from'./components/Sidebar/Sidebar';import Home from'./components/Home/CryptoKnow';import Search from'./components/Search/Search';import ToDoList from'./components/ToDoList/ToDoList';import AvailableAirdrops from'./components/AvailableAirdrops/AvailableAirdrops';import Quests from'./components/Quests/Quests';import AvailableOpportunities from'./components/AvailableOpportunities/AvailableOpportunities';import Contribute from'./components/Contribute/ContributeSubmissionForm';import Leaderboard from'./components/Leaderboard/Leaderboard';import Harvests from'./components/Harvests/Harvests';import FAQs from'./components/FAQs/FAQs';import'./App.css';// Initialize Supabase\nimport{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const supabaseUrl=\"https://sudquzoonuxtvmjhvjpr.supabase.co\";const supabaseAnonKey=\"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InN1ZHF1em9vbnV4dHZtamh2anByIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDAwNDg0ODMsImV4cCI6MjA1NTYyNDQ4M30.-9gQ6aQXagta6ZxxPNUw5qu40X0O04VfuoC3R63ZFss\";const supabase=createClient(supabaseUrl,supabaseAnonKey);const App=()=>{const[user,setUser]=useState(null);useEffect(()=>{const fetchUser=async()=>{const{data:{user}}=await supabase.auth.getUser();if(user){setUser(user);saveUserToDatabase(user);}else{console.log(\"⚠️ No user found in session.\");}};fetchUser();// 🔥 FIX: Ensure proper cleanup for auth state listener\nconst{data:authListener}=supabase.auth.onAuthStateChange((event,session)=>{const currentUser=(session===null||session===void 0?void 0:session.user)||null;setUser(currentUser);if(currentUser){saveUserToDatabase(currentUser);console.log(\"🔄 User updated:\",currentUser);}});return()=>{authListener===null||authListener===void 0?void 0:authListener.unsubscribe();// ✅ Properly unsubscribe\n};},[]);const saveUserToDatabase=async user=>{var _user$user_metadata,_user$user_metadata2;if(!user)return;const discordUsername=((_user$user_metadata=user.user_metadata)===null||_user$user_metadata===void 0?void 0:_user$user_metadata.user_name)||((_user$user_metadata2=user.user_metadata)===null||_user$user_metadata2===void 0?void 0:_user$user_metadata2.full_name)||'';const{data,error}=await supabase.from('users').upsert({id:user.id,discord_username:discordUsername,email:user.email});if(error)console.error('❌ Error saving user:',error.message);else console.log('✅ User saved:',data);};const handleLogin=async()=>{const{error}=await supabase.auth.signInWithOAuth({provider:'discord',options:{redirectTo:'https://cryptoknow.space'}});if(error)console.error(\"❌ Login Error:\",error);};const handleLogout=async()=>{await supabase.auth.signOut();setUser(null);};return/*#__PURE__*/_jsx(BrowserRouter,{children:/*#__PURE__*/_jsxs(\"div\",{className:\"app\",children:[/*#__PURE__*/_jsx(Sidebar,{isLoggedIn:!!user}),/*#__PURE__*/_jsxs(\"div\",{className:\"main-content\",children:[/*#__PURE__*/_jsxs(Routes,{children:[/*#__PURE__*/_jsx(Route,{path:\"/\",element:/*#__PURE__*/_jsx(Home,{user:user})}),/*#__PURE__*/_jsx(Route,{path:\"/search\",element:/*#__PURE__*/_jsx(Search,{})}),/*#__PURE__*/_jsx(Route,{path:\"/to-do-list\",element:/*#__PURE__*/_jsx(ToDoList,{currentUser:user})}),/*#__PURE__*/_jsx(Route,{path:\"/available-airdrops\",element:/*#__PURE__*/_jsx(AvailableAirdrops,{})}),/*#__PURE__*/_jsx(Route,{path:\"/quests\",element:/*#__PURE__*/_jsx(Quests,{})}),/*#__PURE__*/_jsx(Route,{path:\"/available-opportunities\",element:/*#__PURE__*/_jsx(AvailableOpportunities,{})}),/*#__PURE__*/_jsx(Route,{path:\"/contribute\",element:/*#__PURE__*/_jsx(Contribute,{})}),/*#__PURE__*/_jsx(Route,{path:\"/leaderboard\",element:/*#__PURE__*/_jsx(Leaderboard,{})}),/*#__PURE__*/_jsx(Route,{path:\"/harvests\",element:/*#__PURE__*/_jsx(Harvests,{})}),/*#__PURE__*/_jsx(Route,{path:\"/faqs\",element:/*#__PURE__*/_jsx(FAQs,{})})]}),/*#__PURE__*/_jsx(\"div\",{style:{display:'flex',justifyContent:'center',alignItems:'center',width:'100%',marginTop:'20px'},children:/*#__PURE__*/_jsx(\"button\",{onClick:user?handleLogout:handleLogin,children:user?'Log Out':'Log In with Discord'})})]})]})});};export default App;","map":{"version":3,"names":["React","useState","useEffect","BrowserRouter","Routes","Route","createClient","Sidebar","Home","Search","ToDoList","AvailableAirdrops","Quests","AvailableOpportunities","Contribute","Leaderboard","Harvests","FAQs","jsx","_jsx","jsxs","_jsxs","supabaseUrl","supabaseAnonKey","supabase","App","user","setUser","fetchUser","data","auth","getUser","saveUserToDatabase","console","log","authListener","onAuthStateChange","event","session","currentUser","unsubscribe","_user$user_metadata","_user$user_metadata2","discordUsername","user_metadata","user_name","full_name","error","from","upsert","id","discord_username","email","message","handleLogin","signInWithOAuth","provider","options","redirectTo","handleLogout","signOut","children","className","isLoggedIn","path","element","style","display","justifyContent","alignItems","width","marginTop","onClick"],"sources":["C:/Users/opril/cryptoknow/src/App.js"],"sourcesContent":["// src/App.js\r\nimport React, { useState, useEffect } from 'react';\r\nimport { BrowserRouter, Routes, Route } from 'react-router-dom';\r\nimport { createClient } from '@supabase/supabase-js';\r\nimport Sidebar from './components/Sidebar/Sidebar';\r\nimport Home from './components/Home/CryptoKnow';\r\nimport Search from './components/Search/Search';\r\nimport ToDoList from './components/ToDoList/ToDoList';\r\nimport AvailableAirdrops from './components/AvailableAirdrops/AvailableAirdrops';\r\nimport Quests from './components/Quests/Quests';\r\nimport AvailableOpportunities from './components/AvailableOpportunities/AvailableOpportunities';\r\nimport Contribute from './components/Contribute/ContributeSubmissionForm';\r\nimport Leaderboard from './components/Leaderboard/Leaderboard';\r\nimport Harvests from './components/Harvests/Harvests';\r\nimport FAQs from './components/FAQs/FAQs';\r\nimport './App.css';\r\n\r\n// Initialize Supabase\r\nconst supabaseUrl = \"https://sudquzoonuxtvmjhvjpr.supabase.co\";\r\nconst supabaseAnonKey = \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InN1ZHF1em9vbnV4dHZtamh2anByIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDAwNDg0ODMsImV4cCI6MjA1NTYyNDQ4M30.-9gQ6aQXagta6ZxxPNUw5qu40X0O04VfuoC3R63ZFss\";\r\nconst supabase = createClient(supabaseUrl, supabaseAnonKey);\r\n\r\nconst App = () => {\r\n  const [user, setUser] = useState(null);\r\n\r\n  useEffect(() => {\r\n    const fetchUser = async () => {\r\n      const { data: { user } } = await supabase.auth.getUser();\r\n      if (user) {\r\n        setUser(user);\r\n        saveUserToDatabase(user);\r\n      } else {\r\n        console.log(\"⚠️ No user found in session.\");\r\n      }\r\n    };\r\n\r\n    fetchUser();\r\n\r\n    // 🔥 FIX: Ensure proper cleanup for auth state listener\r\n    const { data: authListener } = supabase.auth.onAuthStateChange((event, session) => {\r\n      const currentUser = session?.user || null;\r\n      setUser(currentUser);\r\n      if (currentUser) {\r\n        saveUserToDatabase(currentUser);\r\n        console.log(\"🔄 User updated:\", currentUser);\r\n      }\r\n    });\r\n\r\n    return () => {\r\n      authListener?.unsubscribe(); // ✅ Properly unsubscribe\r\n    };\r\n  }, []);\r\n\r\n  const saveUserToDatabase = async (user) => {\r\n    if (!user) return;\r\n\r\n    const discordUsername = user.user_metadata?.user_name || user.user_metadata?.full_name || '';\r\n\r\n    const { data, error } = await supabase\r\n      .from('users')\r\n      .upsert({\r\n        id: user.id,\r\n        discord_username: discordUsername,\r\n        email: user.email,\r\n      });\r\n\r\n    if (error) console.error('❌ Error saving user:', error.message);\r\n    else console.log('✅ User saved:', data);\r\n  };\r\n\r\n  const handleLogin = async () => {\r\n    const { error } = await supabase.auth.signInWithOAuth({\r\n      provider: 'discord',\r\n      options: { redirectTo: 'https://cryptoknow.space' }\r\n    });\r\n    if (error) console.error(\"❌ Login Error:\", error);\r\n  };\r\n\r\n  const handleLogout = async () => {\r\n    await supabase.auth.signOut();\r\n    setUser(null);\r\n  };\r\n\r\n  return (\r\n    <BrowserRouter>\r\n      <div className=\"app\">\r\n        <Sidebar isLoggedIn={!!user} />\r\n        <div className=\"main-content\">\r\n          <Routes>\r\n            <Route path=\"/\" element={<Home user={user} />} />\r\n\t\t\t<Route path=\"/search\" element={<Search />} />\r\n            <Route path=\"/to-do-list\" element={<ToDoList currentUser={user} />} />\r\n            <Route path=\"/available-airdrops\" element={<AvailableAirdrops />} />\r\n            <Route path=\"/quests\" element={<Quests />} />\r\n            <Route path=\"/available-opportunities\" element={<AvailableOpportunities />} />\r\n\t\t\t<Route path=\"/contribute\" element={<Contribute />} />\r\n            <Route path=\"/leaderboard\" element={<Leaderboard />} />\r\n            <Route path=\"/harvests\" element={<Harvests />} />\r\n            <Route path=\"/faqs\" element={<FAQs />} />\r\n          </Routes>\r\n\r\n          {/* Centered Login/Logout Button */}\r\n          <div style={{ display: 'flex', justifyContent: 'center', alignItems: 'center', width: '100%', marginTop: '20px' }}>\r\n            <button onClick={user ? handleLogout : handleLogin}>\r\n              {user ? 'Log Out' : 'Log In with Discord'}\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </BrowserRouter>\r\n  );\r\n};\r\n\r\nexport default App;\r\n"],"mappings":"AAAA;AACA,MAAO,CAAAA,KAAK,EAAIC,QAAQ,CAAEC,SAAS,KAAQ,OAAO,CAClD,OAASC,aAAa,CAAEC,MAAM,CAAEC,KAAK,KAAQ,kBAAkB,CAC/D,OAASC,YAAY,KAAQ,uBAAuB,CACpD,MAAO,CAAAC,OAAO,KAAM,8BAA8B,CAClD,MAAO,CAAAC,IAAI,KAAM,8BAA8B,CAC/C,MAAO,CAAAC,MAAM,KAAM,4BAA4B,CAC/C,MAAO,CAAAC,QAAQ,KAAM,gCAAgC,CACrD,MAAO,CAAAC,iBAAiB,KAAM,kDAAkD,CAChF,MAAO,CAAAC,MAAM,KAAM,4BAA4B,CAC/C,MAAO,CAAAC,sBAAsB,KAAM,4DAA4D,CAC/F,MAAO,CAAAC,UAAU,KAAM,kDAAkD,CACzE,MAAO,CAAAC,WAAW,KAAM,sCAAsC,CAC9D,MAAO,CAAAC,QAAQ,KAAM,gCAAgC,CACrD,MAAO,CAAAC,IAAI,KAAM,wBAAwB,CACzC,MAAO,WAAW,CAElB;AAAA,OAAAC,GAAA,IAAAC,IAAA,CAAAC,IAAA,IAAAC,KAAA,yBACA,KAAM,CAAAC,WAAW,CAAG,0CAA0C,CAC9D,KAAM,CAAAC,eAAe,CAAG,kNAAkN,CAC1O,KAAM,CAAAC,QAAQ,CAAGlB,YAAY,CAACgB,WAAW,CAAEC,eAAe,CAAC,CAE3D,KAAM,CAAAE,GAAG,CAAGA,CAAA,GAAM,CAChB,KAAM,CAACC,IAAI,CAAEC,OAAO,CAAC,CAAG1B,QAAQ,CAAC,IAAI,CAAC,CAEtCC,SAAS,CAAC,IAAM,CACd,KAAM,CAAA0B,SAAS,CAAG,KAAAA,CAAA,GAAY,CAC5B,KAAM,CAAEC,IAAI,CAAE,CAAEH,IAAK,CAAE,CAAC,CAAG,KAAM,CAAAF,QAAQ,CAACM,IAAI,CAACC,OAAO,CAAC,CAAC,CACxD,GAAIL,IAAI,CAAE,CACRC,OAAO,CAACD,IAAI,CAAC,CACbM,kBAAkB,CAACN,IAAI,CAAC,CAC1B,CAAC,IAAM,CACLO,OAAO,CAACC,GAAG,CAAC,8BAA8B,CAAC,CAC7C,CACF,CAAC,CAEDN,SAAS,CAAC,CAAC,CAEX;AACA,KAAM,CAAEC,IAAI,CAAEM,YAAa,CAAC,CAAGX,QAAQ,CAACM,IAAI,CAACM,iBAAiB,CAAC,CAACC,KAAK,CAAEC,OAAO,GAAK,CACjF,KAAM,CAAAC,WAAW,CAAG,CAAAD,OAAO,SAAPA,OAAO,iBAAPA,OAAO,CAAEZ,IAAI,GAAI,IAAI,CACzCC,OAAO,CAACY,WAAW,CAAC,CACpB,GAAIA,WAAW,CAAE,CACfP,kBAAkB,CAACO,WAAW,CAAC,CAC/BN,OAAO,CAACC,GAAG,CAAC,kBAAkB,CAAEK,WAAW,CAAC,CAC9C,CACF,CAAC,CAAC,CAEF,MAAO,IAAM,CACXJ,YAAY,SAAZA,YAAY,iBAAZA,YAAY,CAAEK,WAAW,CAAC,CAAC,CAAE;AAC/B,CAAC,CACH,CAAC,CAAE,EAAE,CAAC,CAEN,KAAM,CAAAR,kBAAkB,CAAG,KAAO,CAAAN,IAAI,EAAK,KAAAe,mBAAA,CAAAC,oBAAA,CACzC,GAAI,CAAChB,IAAI,CAAE,OAEX,KAAM,CAAAiB,eAAe,CAAG,EAAAF,mBAAA,CAAAf,IAAI,CAACkB,aAAa,UAAAH,mBAAA,iBAAlBA,mBAAA,CAAoBI,SAAS,KAAAH,oBAAA,CAAIhB,IAAI,CAACkB,aAAa,UAAAF,oBAAA,iBAAlBA,oBAAA,CAAoBI,SAAS,GAAI,EAAE,CAE5F,KAAM,CAAEjB,IAAI,CAAEkB,KAAM,CAAC,CAAG,KAAM,CAAAvB,QAAQ,CACnCwB,IAAI,CAAC,OAAO,CAAC,CACbC,MAAM,CAAC,CACNC,EAAE,CAAExB,IAAI,CAACwB,EAAE,CACXC,gBAAgB,CAAER,eAAe,CACjCS,KAAK,CAAE1B,IAAI,CAAC0B,KACd,CAAC,CAAC,CAEJ,GAAIL,KAAK,CAAEd,OAAO,CAACc,KAAK,CAAC,sBAAsB,CAAEA,KAAK,CAACM,OAAO,CAAC,CAAC,IAC3D,CAAApB,OAAO,CAACC,GAAG,CAAC,eAAe,CAAEL,IAAI,CAAC,CACzC,CAAC,CAED,KAAM,CAAAyB,WAAW,CAAG,KAAAA,CAAA,GAAY,CAC9B,KAAM,CAAEP,KAAM,CAAC,CAAG,KAAM,CAAAvB,QAAQ,CAACM,IAAI,CAACyB,eAAe,CAAC,CACpDC,QAAQ,CAAE,SAAS,CACnBC,OAAO,CAAE,CAAEC,UAAU,CAAE,0BAA2B,CACpD,CAAC,CAAC,CACF,GAAIX,KAAK,CAAEd,OAAO,CAACc,KAAK,CAAC,gBAAgB,CAAEA,KAAK,CAAC,CACnD,CAAC,CAED,KAAM,CAAAY,YAAY,CAAG,KAAAA,CAAA,GAAY,CAC/B,KAAM,CAAAnC,QAAQ,CAACM,IAAI,CAAC8B,OAAO,CAAC,CAAC,CAC7BjC,OAAO,CAAC,IAAI,CAAC,CACf,CAAC,CAED,mBACER,IAAA,CAAChB,aAAa,EAAA0D,QAAA,cACZxC,KAAA,QAAKyC,SAAS,CAAC,KAAK,CAAAD,QAAA,eAClB1C,IAAA,CAACZ,OAAO,EAACwD,UAAU,CAAE,CAAC,CAACrC,IAAK,CAAE,CAAC,cAC/BL,KAAA,QAAKyC,SAAS,CAAC,cAAc,CAAAD,QAAA,eAC3BxC,KAAA,CAACjB,MAAM,EAAAyD,QAAA,eACL1C,IAAA,CAACd,KAAK,EAAC2D,IAAI,CAAC,GAAG,CAACC,OAAO,cAAE9C,IAAA,CAACX,IAAI,EAACkB,IAAI,CAAEA,IAAK,CAAE,CAAE,CAAE,CAAC,cAC1DP,IAAA,CAACd,KAAK,EAAC2D,IAAI,CAAC,SAAS,CAACC,OAAO,cAAE9C,IAAA,CAACV,MAAM,GAAE,CAAE,CAAE,CAAC,cACpCU,IAAA,CAACd,KAAK,EAAC2D,IAAI,CAAC,aAAa,CAACC,OAAO,cAAE9C,IAAA,CAACT,QAAQ,EAAC6B,WAAW,CAAEb,IAAK,CAAE,CAAE,CAAE,CAAC,cACtEP,IAAA,CAACd,KAAK,EAAC2D,IAAI,CAAC,qBAAqB,CAACC,OAAO,cAAE9C,IAAA,CAACR,iBAAiB,GAAE,CAAE,CAAE,CAAC,cACpEQ,IAAA,CAACd,KAAK,EAAC2D,IAAI,CAAC,SAAS,CAACC,OAAO,cAAE9C,IAAA,CAACP,MAAM,GAAE,CAAE,CAAE,CAAC,cAC7CO,IAAA,CAACd,KAAK,EAAC2D,IAAI,CAAC,0BAA0B,CAACC,OAAO,cAAE9C,IAAA,CAACN,sBAAsB,GAAE,CAAE,CAAE,CAAC,cACvFM,IAAA,CAACd,KAAK,EAAC2D,IAAI,CAAC,aAAa,CAACC,OAAO,cAAE9C,IAAA,CAACL,UAAU,GAAE,CAAE,CAAE,CAAC,cAC5CK,IAAA,CAACd,KAAK,EAAC2D,IAAI,CAAC,cAAc,CAACC,OAAO,cAAE9C,IAAA,CAACJ,WAAW,GAAE,CAAE,CAAE,CAAC,cACvDI,IAAA,CAACd,KAAK,EAAC2D,IAAI,CAAC,WAAW,CAACC,OAAO,cAAE9C,IAAA,CAACH,QAAQ,GAAE,CAAE,CAAE,CAAC,cACjDG,IAAA,CAACd,KAAK,EAAC2D,IAAI,CAAC,OAAO,CAACC,OAAO,cAAE9C,IAAA,CAACF,IAAI,GAAE,CAAE,CAAE,CAAC,EACnC,CAAC,cAGTE,IAAA,QAAK+C,KAAK,CAAE,CAAEC,OAAO,CAAE,MAAM,CAAEC,cAAc,CAAE,QAAQ,CAAEC,UAAU,CAAE,QAAQ,CAAEC,KAAK,CAAE,MAAM,CAAEC,SAAS,CAAE,MAAO,CAAE,CAAAV,QAAA,cAChH1C,IAAA,WAAQqD,OAAO,CAAE9C,IAAI,CAAGiC,YAAY,CAAGL,WAAY,CAAAO,QAAA,CAChDnC,IAAI,CAAG,SAAS,CAAG,qBAAqB,CACnC,CAAC,CACN,CAAC,EACH,CAAC,EACH,CAAC,CACO,CAAC,CAEpB,CAAC,CAED,cAAe,CAAAD,GAAG","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}